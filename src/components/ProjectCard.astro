---
import type { ImageMetadata } from "astro"; // Importante el 'type' y que venga de 'astro'
import { Image } from "astro:assets";
import { getLangFromUrl, useTranslations } from "../i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

interface Props {
  title: string;
  description: string;
  tags: string[];
  image: any;
  galleryImages?: any[]; // Nueva propiedad para las fotos extras
  link?: string; // nuevo: propiedad opcional para el link
}

const {
  title,
  description,
  tags,
  image,
  galleryImages = [],
  link,
} = Astro.props;
---

<div
  class="group grid md:grid-cols-2 gap-8 items-center bg-white/5 p-6 rounded-2xl border border-white/10 hover:border-blue-500/30 transition-all duration-500"
>
  <div
    class="relative overflow-hidden rounded-xl aspect-video cursor-zoom-in pswp-gallery"
  >
    <a
      href={image.src}
      data-pswp-width={image.width}
      data-pswp-height={image.height}
      target="_blank"
    >
      <img
        src={image.src}
        alt={title}
        class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
      />
    </a>

    <div class="hidden">
      {
        galleryImages.map((img) => (
          <a
            href={img.src}
            data-pswp-width={img.width}
            data-pswp-height={img.height}
          />
        ))
      }
    </div>
  </div>

  <div class="space-y-4">
    <div class="flex flex-wrap gap-2">
      {
        tags.map((tag) => (
          <span class="text-[10px] font-mono text-blue-400 bg-blue-500/10 px-2 py-1 rounded uppercase">
            {tag}
          </span>
        ))
      }
    </div>
    <h3 class="text-2xl font-bold text-white leading-tight">{title}</h3>
    <p class="text-neutral-400 text-sm leading-relaxed">{description}</p>
    {
      link && (
        <div class="pt-2">
          <a
            href={link}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-2 text-[11px] font-mono font-bold text-blue-400 hover:text-white transition-colors group/link"
          >
            {/* Aquí usamos la traducción dinámica */}
            <span>{t("projects.view_project")}</span>

            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-3 h-3 transform group-hover/link:translate-x-1 group-hover/link:-translate-y-1 transition-transform"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
              />
            </svg>
          </a>
        </div>
      )
    }
  </div>
</div>

<script>
  import PhotoSwipeLightbox from "photoswipe/lightbox";
  import "photoswipe/style.css";

  const lightbox = new PhotoSwipeLightbox({
    gallery: ".pswp-gallery",
    children: "a",
    pswpModule: () => import("photoswipe"),
  });
  lightbox.init();
</script>
